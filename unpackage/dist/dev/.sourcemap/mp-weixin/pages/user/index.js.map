{"version":3,"file":"index.js","sources":["pages/user/index.vue","pages/user/index.vue?type=page"],"sourcesContent":["<template>\r\n\t<view>\r\n\t\t<view class=\"op-cells\"\r\n\t\t\tstyle=\"background-color: #ffffff; padding: 0 0 60rpx 0; overflow: hidden; text-align: center\">\r\n\t\t\t<view style=\"margin-top: 40rpx\">\r\n\t\t\t\t<view\r\n\t\t\t\t\tstyle=\"display: inline-block; width: 150rpx; height: 150rpx; border-radius: 200rpx; overflow: hidden\">\r\n\t\t\t\t\t<block v-if=\"mine.avatar\">\r\n\t\t\t\t\t\t<image :src=\"mine.avatar_url\" style=\"width: 150rpx; height: 150rpx\" />\r\n\t\t\t\t\t</block>\r\n\t\t\t\t\t<block v-else>\r\n\t\t\t\t\t\t<image src=\"/static/resource/images/avatar.jpg\" style=\"width: 150rpx; height: 150rpx\" />\r\n\t\t\t\t\t</block>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view style=\"padding-top: 20rpx\">\r\n\t\t\t\t<text class=\"user-nickname\">{{ mine.nickname ? mine.nickname : '用户' + mine._id }}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"weui-cells op-cells\" style=\"margin-top: 20rpx\">\r\n\t\t\t<view class=\"weui-cell\">\r\n\t\t\t\t<view class=\"weui-cell__bd\">我的订单</view>\r\n\t\t\t\t<view class=\"weui-cell__ft\"><text @tap=\"toOrders\" data-filt=\"\" style=\"font-size: 26rpx\">全部</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"weui-cell\" style=\"padding: 0\">\r\n\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t<view class=\"data-cell\" hover-class=\"weui-cell_active\" data-filt=\"1\" @tap=\"toOrders\">\r\n\t\t\t\t\t\t<view class=\"data-icon\">\r\n\t\t\t\t\t\t\t<image src=\"/static/resource/images/od_10.png\" mode=\"widthFix\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"data-txt\">待支付</view>\r\n\t\t\t\t\t\t<text v-if=\"statistic.topays > 0\"\r\n\t\t\t\t\t\t\tclass=\"data-cell-hint data-cell-hint-red\">{{ statistic.topays }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t<view class=\"data-cell\" hover-class=\"weui-cell_active\" data-filt=\"2\" @tap=\"toOrders\">\r\n\t\t\t\t\t\t<view class=\"data-icon\">\r\n\t\t\t\t\t\t\t<image src=\"/static/resource/images/od_20.png\" mode=\"widthFix\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"data-txt\">待服务</view>\r\n\t\t\t\t\t\t<text v-if=\"statistic.todos > 0\"\r\n\t\t\t\t\t\t\tclass=\"data-cell-hint data-cell-hint-red\">{{ statistic.todos }}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t<view class=\"data-cell\" hover-class=\"weui-cell_active\" data-filt=\"3\" @tap=\"toOrders\">\r\n\t\t\t\t\t\t<view class=\"data-icon\">\r\n\t\t\t\t\t\t\t<image src=\"/static/resource/images/od_30.png\" mode=\"widthFix\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"data-txt\">已完成</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t<view class=\"data-cell\" hover-class=\"weui-cell_active\" data-filt=\"4\" @tap=\"toOrders\">\r\n\t\t\t\t\t\t<view class=\"data-icon\">\r\n\t\t\t\t\t\t\t<image src=\"/static/resource/images/od_40.png\" mode=\"widthFix\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"data-txt\">已取消</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"weui-cells op-cells\" style=\"margin-top: 20rpx\">\r\n\t\t\t<view class=\"weui-cell weui-cell_access\" hover-class=\"weui-cell_active\" @tap=\"toServiceManager\">\r\n\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t<image src=\"/static/resource/images/ic_clients.png\"\r\n\t\t\t\t\t\tstyle=\"display: block; margin-right: 20rpx; width: 20px; height: 20px\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"weui-cell__bd\">服务对象管理</view>\r\n\t\t\t\t<view class=\"weui-cell__ft weui-cell__ft_in-access\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"weui-cell weui-cell_access\" hover-class=\"weui-cell_active\" @tap=\"showShareModal\">\r\n\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t<image src=\"/static/resource/images/ic_share.png\"\r\n\t\t\t\t\t\tstyle=\"display: block; margin-right: 20rpx; width: 20px; height: 20px\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"weui-cell__bd\">分享转发</view>\r\n\t\t\t\t<view class=\"weui-cell__ft weui-cell__ft_in-access\"></view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<share :shareModal=\"clone_shareModal\"></share>\r\n\r\n\t\t<!-- 手机登录弹窗 -->\r\n\t\t<uni-popup ref=\"popup\" type=\"center\" :is-mask-click=\"false\" background-color=\"#fff\">\r\n\t\t\t<view class=\"popup-content\">\r\n\t\t\t\t<view class=\"group\">\r\n\t\t\t\t\t<input class=\"uni-input\" type=\"tel\" v-model=\"validMobile.phone\" placeholder=\"手机号\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"group\">\r\n\t\t\t\t\t<input class=\"uni-input\" v-model=\"validMobile.validCode\" placeholder=\"请输入验证码\" />\r\n\t\t\t\t\t<text class=\"valid-text\" @click=\"countdownChange\">{{countdown.validText}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"btns\">\r\n\t\t\t\t<view class=\"cancal\" @click=\"cancal\">取消</view>\r\n\t\t\t\t<view class=\"ok\" @click=\"ok\">确定</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\r\n\t\tonMounted\r\n\t} from 'vue'\r\n\r\n\tconst app = getApp()\r\n\tconst mine = ref({}) // 用户信息\r\n\tconst statistic = ref({}) // 订单数量\r\n\tconst popup = ref(null) // 登录弹框\r\n\tconst validMobile = ref({ // \r\n\t\tvalidCode: '', // 验证码\r\n\t\tphone: '' // 手机号\r\n\t})\r\n\t// 验证码\r\n\tconst countdown = ref({\r\n\t\tvalidText: '获取验证码',\r\n\t\ttime: 60, // 倒计时\r\n\t})\r\n\r\n\tonMounted(() => {\r\n\t\tgetUserInfo()\r\n\t})\r\n\r\n\t// 获取个人信息\r\n\tconst getUserInfo = () => {\r\n\t\t// 如果用户没登录就弹框手机验证码登录\r\n\t\tif (!uni.getStorageSync('token')) {\r\n\t\t\treturn popup.value.open('center')\r\n\t\t}\r\n\r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/User/index',\r\n\t\t\tmethod: 'GET',\r\n\t\t\theader: {\r\n\t\t\t\ttoken: uni.getStorageSync('token')\r\n\t\t\t},\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tmine.value = res.data.mine\r\n\t\t\t\tstatistic.value = res.data.statistic\r\n\r\n\t\t\t},\r\n\t\t\tfail: res => {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: res.msg\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t// 去订单列表\r\n\tconst toOrders = (e) => {\r\n\t\tif (e.currentTarget.dataset.filt) {\r\n\t\t\t// 将选中的订单状态保存到全局，去订单列表时就能直接获取并跳转到对应的tab栏\r\n\t\t\tapp.globalData.filt = e.currentTarget.dataset.filt;\r\n\t\t} else {\r\n\t\t\tapp.globalData.filt = '';\r\n\t\t}\r\n\r\n\t\tuni.switchTab({\r\n\t\t\turl: '../order/index'\r\n\t\t})\r\n\t}\r\n\r\n\tconst clone_shareModal = ref(false) // 控制转发弹窗的显/隐\r\n\t// 展示转发组件\r\n\tconst showShareModal = () => {\r\n\t\tclone_shareModal.value = !clone_shareModal.value\r\n\t}\r\n\t// 去服务管理\r\n\tconst toServiceManager = () => {\r\n\t\tuni.navigateTo({\r\n\t\t\turl: '../clients/index'\r\n\t\t})\r\n\t}\r\n\r\n\r\n\r\n\t// 登录\r\n\tlet flag = false // 做防抖\r\n\tconst countdownChange = () => {\r\n\r\n\t\t// 校验 手机号\r\n\t\tif (!validMobile.value.phone) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请输入手机号',\r\n\t\t\t\tduration: 1000,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 1.如果flag还开着,带着有定时器,那么直接return出去\r\n\t\tif (flag) return\r\n\t\t// 2.进来就打开\r\n\t\tflag = true\r\n\t\t// 3.开启定时器\r\n\t\tconst timer = setInterval(() => {\r\n\t\t\tif (countdown.value.time <= 0) {\r\n\t\t\t\tcountdown.value.validText = '获取验证码'\r\n\t\t\t\tcountdown.value.time = 60\r\n\t\t\t\tclearInterval(timer)\r\n\t\t\t\t// 时间走完要关闭\r\n\t\t\t\tflag = false\r\n\t\t\t} else {\r\n\t\t\t\tcountdown.value.time -= 1\r\n\t\t\t\tcountdown.value.validText = `剩余${countdown.value.time}S`\r\n\t\t\t}\r\n\t\t}, 1000)\r\n\r\n\t\t// 获取验证码\r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/get/code',\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata: {\r\n\t\t\t\ttel: validMobile.value.phone // 手机号\r\n\t\t\t},\r\n\t\t\tsuccess: res => {\r\n\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '验证码发送成功,请尽快验证!',\r\n\t\t\t\t\tduration: 1000,\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tfail: res => {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: res.msg,\r\n\t\t\t\t\tduration: 1000,\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t// 取消弹窗\r\n\tconst cancal = () => {\r\n\t\tpopup.value.close() // 关闭弹窗\r\n\t}\r\n\r\n\t// 确认弹窗\r\n\tconst ok = () => {\r\n\t\t// 如果手机号为空 或 验证码为空,则提示用户\r\n\t\tif (!validMobile.value.phone || !validMobile.value.validCode) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请检查输入信息',\r\n\t\t\t\tduration: 1000,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t\t// 验证码验证,正式登录  \r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/user/authentication',\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata: {\r\n\t\t\t\ttel: validMobile.value.phone, // 手机号\r\n\t\t\t\tcode: validMobile.value.validCode // 验证码\r\n\t\t\t},\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\t// 登录成功将token设置到缓存中\r\n\t\t\t\tuni.setStorageSync('token', res.data.token)\r\n\t\t\t\tpopup.value.close() // 关闭弹窗\r\n\t\t\t\t// 接下来获取用户信息\r\n\t\t\t\tgetUserInfo()\r\n\t\t\t},\r\n\t\t\tfail: (res) => {\r\n\t\t\t\tpopup.value.close() // 关闭弹窗\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: res.msg,\r\n\t\t\t\t\tduration: 1000,\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t@import './index.css';\r\n</style>","import MiniProgramPage from '/Users/daykalif/Desktop/project/pages/user/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;AA6GC,UAAM,MAAM,OAAQ;AACpB,UAAM,OAAOA,cAAG,IAAC,EAAE;AACnB,UAAM,YAAYA,cAAG,IAAC,EAAE;AACxB,UAAM,QAAQA,cAAG,IAAC,IAAI;AACtB,UAAM,cAAcA,cAAAA,IAAI;AAAA;AAAA,MACvB,WAAW;AAAA;AAAA,MACX,OAAO;AAAA;AAAA,IACT,CAAE;AAED,UAAM,YAAYA,cAAAA,IAAI;AAAA,MACrB,WAAW;AAAA,MACX,MAAM;AAAA;AAAA,IACR,CAAE;AAEDC,kBAAAA,UAAU,MAAM;AACf,kBAAa;AAAA,IACf,CAAE;AAGD,UAAM,cAAc,MAAM;AAEzB,UAAI,CAACC,cAAG,MAAC,eAAe,OAAO,GAAG;AACjC,eAAO,MAAM,MAAM,KAAK,QAAQ;AAAA,MAChC;AAED,UAAI,WAAW,MAAM,QAAQ;AAAA,QAC5B,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,QAAQ;AAAA,UACP,OAAOA,cAAAA,MAAI,eAAe,OAAO;AAAA,QACjC;AAAA,QACD,SAAS,CAAC,QAAQ;AACjB,eAAK,QAAQ,IAAI,KAAK;AACtB,oBAAU,QAAQ,IAAI,KAAK;AAAA,QAE3B;AAAA,QACD,MAAM,SAAO;AACZA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI;AAAA,UAChB,CAAK;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;AAED,UAAM,WAAW,CAAC,MAAM;AACvB,UAAI,EAAE,cAAc,QAAQ,MAAM;AAEjC,YAAI,WAAW,OAAO,EAAE,cAAc,QAAQ;AAAA,MACjD,OAAS;AACN,YAAI,WAAW,OAAO;AAAA,MACtB;AAEDA,oBAAAA,MAAI,UAAU;AAAA,QACb,KAAK;AAAA,MACR,CAAG;AAAA,IACD;AAED,UAAM,mBAAmBF,cAAG,IAAC,KAAK;AAElC,UAAM,iBAAiB,MAAM;AAC5B,uBAAiB,QAAQ,CAAC,iBAAiB;AAAA,IAC3C;AAED,UAAM,mBAAmB,MAAM;AAC9BE,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,MACR,CAAG;AAAA,IACD;AAKD,QAAI,OAAO;AACX,UAAM,kBAAkB,MAAM;AAG7B,UAAI,CAAC,YAAY,MAAM,OAAO;AAC7B,eAAOA,cAAAA,MAAI,UAAU;AAAA,UACpB,OAAO;AAAA,UACP,UAAU;AAAA,UACV,MAAM;AAAA,QACV,CAAI;AAAA,MACD;AAGD,UAAI;AAAM;AAEV,aAAO;AAEP,YAAM,QAAQ,YAAY,MAAM;AAC/B,YAAI,UAAU,MAAM,QAAQ,GAAG;AAC9B,oBAAU,MAAM,YAAY;AAC5B,oBAAU,MAAM,OAAO;AACvB,wBAAc,KAAK;AAEnB,iBAAO;AAAA,QACX,OAAU;AACN,oBAAU,MAAM,QAAQ;AACxB,oBAAU,MAAM,YAAY,KAAK,UAAU,MAAM,IAAI;AAAA,QACrD;AAAA,MACD,GAAE,GAAI;AAGP,UAAI,WAAW,MAAM,QAAQ;AAAA,QAC5B,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,KAAK,YAAY,MAAM;AAAA;AAAA,QACvB;AAAA,QACD,SAAS,SAAO;AAEfA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,UAAU;AAAA,YACV,MAAM;AAAA,UACX,CAAK;AAAA,QACD;AAAA,QACD,MAAM,SAAO;AACZA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI;AAAA,YACX,UAAU;AAAA,YACV,MAAM;AAAA,UACX,CAAK;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;AAGD,UAAM,SAAS,MAAM;AACpB,YAAM,MAAM,MAAO;AAAA,IACnB;AAGD,UAAM,KAAK,MAAM;AAEhB,UAAI,CAAC,YAAY,MAAM,SAAS,CAAC,YAAY,MAAM,WAAW;AAC7D,eAAOA,cAAAA,MAAI,UAAU;AAAA,UACpB,OAAO;AAAA,UACP,UAAU;AAAA,UACV,MAAM;AAAA,QACV,CAAI;AAAA,MACD;AAED,UAAI,WAAW,MAAM,QAAQ;AAAA,QAC5B,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,KAAK,YAAY,MAAM;AAAA;AAAA,UACvB,MAAM,YAAY,MAAM;AAAA;AAAA,QACxB;AAAA,QACD,SAAS,CAAC,QAAQ;AAEjBA,wBAAAA,MAAI,eAAe,SAAS,IAAI,KAAK,KAAK;AAC1C,gBAAM,MAAM,MAAO;AAEnB,sBAAa;AAAA,QACb;AAAA,QACD,MAAM,CAAC,QAAQ;AACd,gBAAM,MAAM,MAAO;AACnBA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI;AAAA,YACX,UAAU;AAAA,YACV,MAAM;AAAA,UACX,CAAK;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClRF,GAAG,WAAWC,SAAe;"}