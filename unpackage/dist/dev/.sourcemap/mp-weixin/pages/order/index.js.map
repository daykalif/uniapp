{"version":3,"file":"index.js","sources":["pages/order/index.vue","pages/order/index.vue?type=page"],"sourcesContent":["<template>\r\n\t<view>\r\n\t\t<!-- tab -->\r\n\t\t<view style=\"width: 100%; border-bottom: 0 none; position: fixed; z-index: 2\">\r\n\t\t\t<view style=\"background: #ffffff; position: relative\">\r\n\t\t\t\t<view class=\"h-tab vp-flex\">\r\n\t\t\t\t\t<view :class=\"'h-tab-item vp-flex_1 ' + (filt == '' ? 'on' : '')\" @tap=\"onFilterChange('')\">全部\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view :class=\"'h-tab-item vp-flex_1 ' + (filt == 1 ? 'on' : '')\" @tap=\"onFilterChange(1)\">待支付</view>\r\n\t\t\t\t\t<view :class=\"'h-tab-item vp-flex_1 ' + (filt == 2 ? 'on' : '')\" @tap=\"onFilterChange(2)\">待服务</view>\r\n\t\t\t\t\t<view :class=\"'h-tab-item vp-flex_1 ' + (filt == 3 ? 'on' : '')\" @tap=\"onFilterChange(3)\">已完成</view>\r\n\t\t\t\t\t<view :class=\"'h-tab-item vp-flex_1 ' + (filt == 4 ? 'on' : '')\" @tap=\"onFilterChange(4)\">已取消</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 订单列表 -->\r\n\t\t<view style=\"height: 100rpx\"></view>\r\n\t\t<block v-if=\"list != null\">\r\n\t\t\t<view v-if=\"list != null && list.length == 0\" style=\"padding: 40rpx 40rpx 40rpx 40rpx; text-align: center\">\r\n\t\t\t\t<image src=\"/static/resource/images/empty.png\" mode=\"widthFix\" style=\"width: 200rpx\" />\r\n\t\t\t\t<view class=\"f5\">没有相关内容~</view>\r\n\t\t\t</view>\r\n\t\t\t<view v-else class=\"od-list\">\r\n\t\t\t\t<block v-for=\"(item, index) in list\" :key=\"index\">\r\n\t\t\t\t\t<view class=\"od-item\" @tap=\"toOrder(item.out_trade_no)\">\r\n\t\t\t\t\t\t<view class=\"weui-cell weui-cell_access\">\r\n\t\t\t\t\t\t\t<view class=\"weui-cell__hd\">\r\n\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t<image :src=\"item.service_logo_image_url\" mode=\"widthFix\" class=\"od-logo\"\r\n\t\t\t\t\t\t\t\t\t\tstyle=\"width: 100rpx; height: 100rpx; margin-right: 20rpx\" />\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"weui-cell__bd\">\r\n\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t<text style=\"font-weight: bold\">{{ item.service_name }}</text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"od-info\">\r\n\t\t\t\t\t\t\t\t\t<block v-if=\"item.service_stype <= 20\">\r\n\t\t\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t\t\t<text>{{ item.hospital_name }}（{{ item.area_name }}）</text>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t\t\t预约时间：\r\n\t\t\t\t\t\t\t\t\t\t\t<formater :timestamp=\"item.starttime\" format=\"MM-dd hh:mm\"></formater>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t\t\t就诊人员：\r\n\t\t\t\t\t\t\t\t\t\t\t<text>{{ item.client_name }}</text>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t\t<block v-if=\"item.service_stype > 20 && item.service_stype < 100\">\r\n\t\t\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t\t\t<text>{{ item.hospital_name }}（{{ item.area_name }}）</text>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t\t\t处理时间：\r\n\t\t\t\t\t\t\t\t\t\t\t<formater :timestamp=\"item.starttime\" format=\"MM-dd hh:mm\"></formater>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t\t<block v-if=\"item.service_stype > 100\">\r\n\t\t\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t\t\t服务时间：\r\n\t\t\t\t\t\t\t\t\t\t\t<formater :timestamp=\"item.starttime\" format=\"MM-dd hh:mm\"></formater>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t\t\t\t\t服务对象：\r\n\t\t\t\t\t\t\t\t\t\t\t<text>{{ item.client_name }}</text>\r\n\t\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t\t<!-- <view>服务地址：<text>{{item.address.address}}</text> </view> -->\r\n\t\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"weui-cell__ft\">\r\n\t\t\t\t\t\t\t\t<!-- 待付款 -->\r\n\t\t\t\t\t\t\t\t<block v-if=\"item.trade_state == '待支付'\">\r\n\t\t\t\t\t\t\t\t\t<view style=\"color: #ffa200\"><text>待支付</text></view>\r\n\t\t\t\t\t\t\t\t\t<view style=\"color: #ffa200\">\r\n\t\t\t\t\t\t\t\t\t\t<counter style=\"font-size: 24rpx\" :second=\"item._exp_time\"\r\n\t\t\t\t\t\t\t\t\t\t\t@counterOver=\"onCounterOver\" />\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t<!-- 进行中 -->\r\n\t\t\t\t\t\t\t\t<block v-if=\"item.trade_state == '待服务'\">\r\n\t\t\t\t\t\t\t\t\t<view style=\"color: #1da6fd\"><text>待服务</text></view>\r\n\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t<!-- 已完成 -->\r\n\t\t\t\t\t\t\t\t<block v-if=\"item.trade_state == '已完成'\">\r\n\t\t\t\t\t\t\t\t\t<view style=\"color: #21c521\"><text>已完成</text></view>\r\n\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t\t<!-- 已取消 -->\r\n\t\t\t\t\t\t\t\t<block v-if=\"item.trade_state == '已取消'\">\r\n\t\t\t\t\t\t\t\t\t<view style=\"color: #999999\"><text>已取消</text></view>\r\n\t\t\t\t\t\t\t\t</block>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</block>\r\n\t\t\t</view>\r\n\t\t</block>\r\n\r\n\r\n\t\t<!-- 手机登录弹窗 -->\r\n\t\t<uni-popup ref=\"popup\" type=\"center\" :is-mask-click=\"false\" background-color=\"#fff\">\r\n\t\t\t<view class=\"popup-content\">\r\n\t\t\t\t<view class=\"group\">\r\n\t\t\t\t\t<input class=\"uni-input\" type=\"tel\" v-model=\"validMobile.phone\" placeholder=\"手机号\" />\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"group\">\r\n\t\t\t\t\t<input class=\"uni-input\" v-model=\"validMobile.validCode\" placeholder=\"请输入验证码\" />\r\n\t\t\t\t\t<text class=\"valid-text\" @click=\"countdownChange\">{{countdown.validText}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"btns\">\r\n\t\t\t\t<view class=\"cancal\" @click=\"cancal\">取消</view>\r\n\t\t\t\t<view class=\"ok\" @click=\"ok\">确定</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport UQRCode from 'uqrcodejs';\r\n\timport {\r\n\t\tref,\r\n\t\treactive,\r\n\t\tcomputed,\r\n\t\ttoRaw,\r\n\t\tonMounted\r\n\t} from \"vue\"\r\n\tconst app = getApp() // 获取uniapp实例\r\n\tconst filt = ref('') // tab标志\r\n\tconst list = ref([]) // 订单列表\r\n\tconst popup = ref(null) // 登录弹框\r\n\tconst validMobile = ref({ // \r\n\t\tvalidCode: '', // 验证码\r\n\t\tphone: '' // 手机号\r\n\t})\r\n\t// 验证码\r\n\tconst countdown = ref({\r\n\t\tvalidText: '获取验证码',\r\n\t\ttime: 60, // 倒计时\r\n\t})\r\n\r\n\tonMounted(() => {\r\n\t\tconsole.log(app.globalData.filt, ' app.globalData.filt');\r\n\t\t// 获取从个人中心保存到全局的订单状态值\r\n\t\tfilt.value = app.globalData.filt\r\n\t\tgetOrderList()\r\n\t})\r\n\r\n\t// 切换tab栏\r\n\tconst onFilterChange = (status) => {\r\n\t\tif (filt.value == status) return\r\n\t\tfilt.value = status // 将选中的tab标识赋值给选中标识，用于页面样式的切换\r\n\t\tgetOrderList(status)\r\n\t}\r\n\r\n\t// 获取订单列表\r\n\tconst getOrderList = () => {\r\n\t\t// 如果用户没登录就弹框手机验证码登录\r\n\t\tif (!uni.getStorageSync('token')) {\r\n\t\t\treturn popup.value.open('center')\r\n\t\t}\r\n\r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/order/list',\r\n\t\t\tmethod: 'GET',\r\n\t\t\theader: {\r\n\t\t\t\ttoken: uni.getStorageSync('token')\r\n\t\t\t},\r\n\t\t\tdata: {\r\n\t\t\t\tstate: filt.value\r\n\t\t\t},\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tlist.value = res.data\r\n\t\t\t\tconsole.log(res.data, 'res');\r\n\t\t\t},\r\n\t\t\tfail: res => {\r\n\t\t\t\tconsole.log(res, 'res');\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t// 倒计时结束重新获取订单列表\r\n\tconst onCounterOver = () => {\r\n\t\tfilt.value = ''\r\n\t\tgetOrderList()\r\n\t}\r\n\r\n\t// 去订单详情\r\n\tconst toOrder = (id) => {\r\n\t\tuni.navigateTo({\r\n\t\t\turl: `./orderDetail/index?oid=${id}`\r\n\t\t})\r\n\t}\r\n\r\n\r\n\t// 登录\r\n\tlet flag = false // 做防抖\r\n\tconst countdownChange = () => {\r\n\r\n\t\t// 校验 手机号\r\n\t\tif (!validMobile.value.phone) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请输入手机号',\r\n\t\t\t\tduration: 1000,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// 1.如果flag还开着,带着有定时器,那么直接return出去\r\n\t\tif (flag) return\r\n\t\t// 2.进来就打开\r\n\t\tflag = true\r\n\t\t// 3.开启定时器\r\n\t\tconst timer = setInterval(() => {\r\n\t\t\tif (countdown.value.time <= 0) {\r\n\t\t\t\tcountdown.value.validText = '获取验证码'\r\n\t\t\t\tcountdown.value.time = 60\r\n\t\t\t\tclearInterval(timer)\r\n\t\t\t\t// 时间走完要关闭\r\n\t\t\t\tflag = false\r\n\t\t\t} else {\r\n\t\t\t\tcountdown.value.time -= 1\r\n\t\t\t\tcountdown.value.validText = `剩余${countdown.value.time}S`\r\n\t\t\t}\r\n\t\t}, 1000)\r\n\r\n\t\t// 获取验证码\r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/get/code',\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata: {\r\n\t\t\t\ttel: validMobile.value.phone // 手机号\r\n\t\t\t},\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '验证码发送成功,请尽快验证!',\r\n\t\t\t\t\tduration: 1000,\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tfail: res => {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: res.msg,\r\n\t\t\t\t\tduration: 1000,\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\t// 取消弹窗\r\n\tconst cancal = () => {\r\n\t\tpopup.value.close() // 关闭弹窗\r\n\t}\r\n\r\n\t// 确认弹窗\r\n\tconst ok = () => {\r\n\t\t// 如果手机号为空 或 验证码为空,则提示用户\r\n\t\tif (!validMobile.value.phone || !validMobile.value.validCode) {\r\n\t\t\treturn uni.showToast({\r\n\t\t\t\ttitle: '请检查输入信息',\r\n\t\t\t\tduration: 1000,\r\n\t\t\t\ticon: 'none'\r\n\t\t\t})\r\n\t\t}\r\n\t\t// 验证码验证,正式登录  \r\n\t\tapp.globalData.utils.request({\r\n\t\t\turl: '/user/authentication',\r\n\t\t\tmethod: 'POST',\r\n\t\t\tdata: {\r\n\t\t\t\ttel: validMobile.value.phone, // 手机号\r\n\t\t\t\tcode: validMobile.value.validCode // 验证码\r\n\t\t\t},\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\t// 登录成功将token设置到缓存中\r\n\t\t\t\tuni.setStorageSync('token', res.data.token)\r\n\t\t\t\tpopup.value.close() // 关闭弹窗\r\n\t\t\t\t// 接下来获取订单列表\r\n\t\t\t\tgetOrderList()\r\n\t\t\t},\r\n\t\t\tfail: (res) => {\r\n\t\t\t\tpopup.value.close() // 关闭弹窗\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: res.msg,\r\n\t\t\t\t\tduration: 1000,\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t@import \"./index.css\"\r\n</style>","import MiniProgramPage from '/Users/daykalif/Desktop/project/pages/order/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;;AAkIC,UAAM,MAAM,OAAQ;AACpB,UAAM,OAAOA,cAAG,IAAC,EAAE;AACnB,UAAM,OAAOA,cAAG,IAAC,EAAE;AACnB,UAAM,QAAQA,cAAG,IAAC,IAAI;AACtB,UAAM,cAAcA,cAAAA,IAAI;AAAA;AAAA,MACvB,WAAW;AAAA;AAAA,MACX,OAAO;AAAA;AAAA,IACT,CAAE;AAED,UAAM,YAAYA,cAAAA,IAAI;AAAA,MACrB,WAAW;AAAA,MACX,MAAM;AAAA;AAAA,IACR,CAAE;AAEDC,kBAAAA,UAAU,MAAM;AACfC,uEAAY,IAAI,WAAW,MAAM,sBAAsB;AAEvD,WAAK,QAAQ,IAAI,WAAW;AAC5B,mBAAc;AAAA,IAChB,CAAE;AAGD,UAAM,iBAAiB,CAAC,WAAW;AAClC,UAAI,KAAK,SAAS;AAAQ;AAC1B,WAAK,QAAQ;AACb,mBAAmB;AAAA,IACnB;AAGD,UAAM,eAAe,MAAM;AAE1B,UAAI,CAACA,cAAG,MAAC,eAAe,OAAO,GAAG;AACjC,eAAO,MAAM,MAAM,KAAK,QAAQ;AAAA,MAChC;AAED,UAAI,WAAW,MAAM,QAAQ;AAAA,QAC5B,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,QAAQ;AAAA,UACP,OAAOA,cAAAA,MAAI,eAAe,OAAO;AAAA,QACjC;AAAA,QACD,MAAM;AAAA,UACL,OAAO,KAAK;AAAA,QACZ;AAAA,QACD,SAAS,SAAO;AACf,eAAK,QAAQ,IAAI;AACjBA,wBAAA,MAAA,MAAA,OAAA,gCAAY,IAAI,MAAM,KAAK;AAAA,QAC3B;AAAA,QACD,MAAM,SAAO;AACZA,wBAAY,MAAA,MAAA,OAAA,gCAAA,KAAK,KAAK;AAAA,QACtB;AAAA,MACJ,CAAG;AAAA,IACD;AAED,UAAM,gBAAgB,MAAM;AAC3B,WAAK,QAAQ;AACb,mBAAc;AAAA,IACd;AAGD,UAAM,UAAU,CAAC,OAAO;AACvBA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK,2BAA2B,EAAE;AAAA,MACrC,CAAG;AAAA,IACD;AAID,QAAI,OAAO;AACX,UAAM,kBAAkB,MAAM;AAG7B,UAAI,CAAC,YAAY,MAAM,OAAO;AAC7B,eAAOA,cAAAA,MAAI,UAAU;AAAA,UACpB,OAAO;AAAA,UACP,UAAU;AAAA,UACV,MAAM;AAAA,QACV,CAAI;AAAA,MACD;AAGD,UAAI;AAAM;AAEV,aAAO;AAEP,YAAM,QAAQ,YAAY,MAAM;AAC/B,YAAI,UAAU,MAAM,QAAQ,GAAG;AAC9B,oBAAU,MAAM,YAAY;AAC5B,oBAAU,MAAM,OAAO;AACvB,wBAAc,KAAK;AAEnB,iBAAO;AAAA,QACX,OAAU;AACN,oBAAU,MAAM,QAAQ;AACxB,oBAAU,MAAM,YAAY,KAAK,UAAU,MAAM,IAAI;AAAA,QACrD;AAAA,MACD,GAAE,GAAI;AAGP,UAAI,WAAW,MAAM,QAAQ;AAAA,QAC5B,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,KAAK,YAAY,MAAM;AAAA;AAAA,QACvB;AAAA,QACD,SAAS,SAAO;AACfA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,UAAU;AAAA,YACV,MAAM;AAAA,UACX,CAAK;AAAA,QACD;AAAA,QACD,MAAM,SAAO;AACZA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI;AAAA,YACX,UAAU;AAAA,YACV,MAAM;AAAA,UACX,CAAK;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;AAGD,UAAM,SAAS,MAAM;AACpB,YAAM,MAAM,MAAO;AAAA,IACnB;AAGD,UAAM,KAAK,MAAM;AAEhB,UAAI,CAAC,YAAY,MAAM,SAAS,CAAC,YAAY,MAAM,WAAW;AAC7D,eAAOA,cAAAA,MAAI,UAAU;AAAA,UACpB,OAAO;AAAA,UACP,UAAU;AAAA,UACV,MAAM;AAAA,QACV,CAAI;AAAA,MACD;AAED,UAAI,WAAW,MAAM,QAAQ;AAAA,QAC5B,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,MAAM;AAAA,UACL,KAAK,YAAY,MAAM;AAAA;AAAA,UACvB,MAAM,YAAY,MAAM;AAAA;AAAA,QACxB;AAAA,QACD,SAAS,CAAC,QAAQ;AAEjBA,wBAAAA,MAAI,eAAe,SAAS,IAAI,KAAK,KAAK;AAC1C,gBAAM,MAAM,MAAO;AAEnB,uBAAc;AAAA,QACd;AAAA,QACD,MAAM,CAAC,QAAQ;AACd,gBAAM,MAAM,MAAO;AACnBA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO,IAAI;AAAA,YACX,UAAU;AAAA,YACV,MAAM;AAAA,UACX,CAAK;AAAA,QACD;AAAA,MACJ,CAAG;AAAA,IACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClSF,GAAG,WAAWC,SAAe;"}